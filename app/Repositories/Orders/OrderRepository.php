<?php
namespace App\Repositories\Orders;
use App\Events\Order\OrderCreateEvent;
use App\Repositories\BaseRepository;
use App\Repositories\Users\User;
use Illuminate\Support\Facades\Auth;

class OrderRepository extends BaseRepository
{
    protected $model;
    private $orderDetailRepository ;
    public function __construct(Order $orders, OrderDetailRepository $orderDetailRepository)
    {
        $this->model = $orders;
        $this->orderDetailRepository = $orderDetailRepository;
    }
    public function create(array $request)
    {
        $data = $request;
        $user = Auth::guard('api')->user();

        $data['user_id'] = $user['id'];

        $order = parent::create($data);
        event(new OrderCreateEvent($order, $request));

        return $order;

    }
    public function delete($id):bool
    {
        $order = $this->getModel()->with(['orderDetails'])->find($id);
        foreach ($order->orderDetails as $orderDetail)
        {
            $orderDetail->delete();
        }
        return parent::delete($id);// TODO: Change the autogenerated stub
    }
}
